C251 COMPILER V5.60.0,  direction                                                          18/06/23  22:22:08  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE direction
OBJECT MODULE PLACED IN .\Out_File\direction.obj
COMPILER INVOKED BY: D:\Keil_v5\C251\BIN\C251.EXE ..\USER\src\direction.c XSMALL WARNINGLEVEL(0) BROWSE INCDIR(..\..\Lib
                    -raries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..\USER\inc;..\USER\src;
                    -..\..\..\DIANCI;..\..\..\..\18--------) DEBUG PRINT(.\Out_File\direction.lst) TABS(2) OBJECT(.\Out_File\direction.obj) 

stmt  level    source

    1          /*
    2           * @Author: lanchanghai
    3           * @Date: 2023-06-09 22:32:02
    4           * @LastEditors: lanchanghai
    5           * @LastEditTime: 2023-06-17 19:37:20
    6           * @FilePath: \DIANCI\Project\USER\src\direction.c
    7           */
    8          #include "headfile.h"
    9          
   10          //èˆµæœºå‚æ•°
   11          #define Servos_Middle 3390               // èˆµæœºä¸­å€¼       
   12          #define Servos_Zmax 3750                 // èˆµæœºå·¦æœ€å€¼       
   13          #define Servos_Ymax 2990                 // èˆµæœºå³æœ€å€¼
   14          //å®šä¹‰ADCçš„æœ€å€¼
   15          //å› ä¸ºä½¿ç”¨12ä½ç²¾åº¦ADCæ•… 2çš„12æ¬¡æ–¹=4096
   16          #define ADC_MAX    4096                  //ADC 12ä½ç²¾åº¦ 2çš„12æ¬¡æ–¹=4096
   17          #define ADC_MIN     0                    
   18          
   19          uint16 DMA_ADC_dat[ADC_CH][(ADC_DATA-4)/2];   //å°†DMAä¸­ADCæ•°æ®é«˜ä½ä½åˆå¹¶(æ¯ä¸€ä¸ªé€šé“è½¬æ¢å…
             -«æ¬¡)
   20          float average[ADC_CH]={0};  //ADCæ¯ä¸€ä¸ªé€šé“å»æ‰æœ€å¤§å°å€¼çš„å¹³å‡å€¼
   21          float normalization_result[ADC_CH];//å¹³å‡å€¼å½’ä¸€åŒ–
   22          
   23          
   24          
   25          //æŠŠDMAä¸­æ•°æ®å’Œåœ¨ä¸€èµ·12ä½æ•°æ®
   26          void pooled_data(void)
   27          {
   28   1           uint8 i,j,n=0,a;
   29   1           a=((ADC_DATA-4));//16
   30   1           for(i=0;i<ADC_CH;i++)
   31   1           {
   32   2             n=0;
   33   2           for(j=0;j<a;j=j+2)
   34   2           {
   35   3            DMA_ADC_dat[i][n] = ((uint16)DmaAdBuffer[i][j])<<8 | DmaAdBuffer[i][j+1];
   36   3             n++;
   37   3           }
   38   2      
   39   2           }
   40   1      
   41   1      }
   42          //è½¯ä»¶æ»¤æ³¢é™å¹…æ³•
   43          //é™å¹…æ³•æ»¤æ³¢//
   44          //å†’æ³¡æ’åºä¸€ä¸ªé€šé“ç”µæ„Ÿçš„å€¼//
   45          void bubble_sort(void)
   46          {
   47   1         uint8 i,j,n,a;
   48   1        uint16 temp;
   49   1          a=((ADC_DATA-4)/2);
   50   1          for(n=0;n<ADC_CH;n++)
   51   1          {
   52   2           for(i=0;i<a;i++)
   53   2           {
   54   3              for(j=0;j<a-1-i;j++)
   55   3              {
   56   4               if(DMA_ADC_dat[n][j]>DMA_ADC_dat[n][j+1])    //è¿™é‡Œé»˜è®¤é‡‡ç”¨å‡åºæ¥æ’åˆ— 
C251 COMPILER V5.60.0,  direction                                                          18/06/23  22:22:08  PAGE 2   

   57   4                {
   58   5                  temp = DMA_ADC_dat[n][j];
   59   5                  DMA_ADC_dat[n][j] = DMA_ADC_dat[n][j+1];
   60   5                  DMA_ADC_dat[n][j+1] = temp;
   61   5                }
   62   4              }
   63   3           }
   64   2          }
   65   1      }
   66          //æ’åºå®Œçš„æ•°ç»„å»æ‰æœ€å¤§æœ€å°å€¼æ±‚å¹³å‡å€¼
   67          void average_value(void)
   68          {
   69   1        uint8 i,n,a;
   70   1          a=((ADC_DATA-4)/2);
   71   1          for(n=0;n<ADC_CH;n++)
   72   1          {
   73   2              average[n] = 0;
   74   2           for(i=1;i<a-1;i++) //å»æ‰æœ€å¤§æœ€å°çš„å€¼
   75   2           {
   76   3              average[n] = average[n]+DMA_ADC_dat[n][i];
   77   3           }
   78   2              average[n] = average[n]/(a-2);
   79   2          }
   80   1      }
   81          //å½’ä¸€åŒ–
   82          /*
   83          å½’ä¸€åŒ–çš„å…¬å¼å¦‚ä¸‹ï¼š(x-Min)/(Max-Min).å…¶ä¸­,xä¸ºå®æ—¶æ£€æµ‹åˆ°çš„å˜é‡,Minä¸Max
   84          ä¸ºæ ‡å®šçš„ç”µæ„Ÿé‡‡é›†æœ€å°ä¸æœ€å¤§å€¼.å…·ä½“ä»£ç å¦‚ä¸‹:
   85          AD_M_Left[0] =(uint16)(99*(LeftAverage[0]-M_Left_min)/(M_Left_max[0]-M_Left_min)+1);
   86          */
   87          //è‹¥æƒ³èˆµæœºæ›´é¡ºæ»‘å¯ä»¥å¯¹åå·®errorçš„è®¡ç®—è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚å°†å½’ä¸€åŒ–åçš„å€¼å¼€æ–¹
   88          void normalization(void)
   89          {
   90   1          uint8 i;
   91   1          for(i=0;i<ADC_CH;i++)
   92   1          {
   93   2          normalization_result[i] =100*((average[i]-ADC_MIN)/(ADC_MAX-ADC_MIN));
   94   2      
   95   2          }
   96   1          
   97   1      }
   98          //å¼€æ–¹
   99          //======================================================================
  100          //å‡½æ•°åç§° : my_sqrt(float number)
  101          //åŠŸèƒ½æè¿° : å¼€å¹³æ–¹ç®—æ³•
  102          //è¾“å…¥å‚æ•° : 
  103          //è¾“å‡ºå‚æ•° : 
  104          //è¿”å›å€¼   : NONE
  105          //å¤‡æ³¨     :  
  106          //======================================================================
  107          float my_sqrt(float number)
  108          {
  109   1          long i;
  110   1          float x, y;
  111   1          const float f = 1.5F;
  112   1          x = number * 0.5F;
  113   1          y = number;
  114   1          i = * ( long * ) &y;
  115   1          i = 0x5f3759df - ( i >> 1 );
  116   1      
  117   1          y = * ( float * ) &i;
  118   1          y = y * ( f - ( x * y * y ) );
  119   1          y = y * ( f - ( x * y * y ) );
  120   1          return number * y;
  121   1      }
  122          float my_pow(float x)
C251 COMPILER V5.60.0,  direction                                                          18/06/23  22:22:08  PAGE 3   

  123          {
  124   1        return x*x;
  125   1      }
  126          //åœ¨è®¡ç®—åå·®ä¹‹å‰åº”è°ƒç”¨å¥½çš„å‡½æ•°
  127          void prepare_dat(void)
  128          {
  129   1         bubble_sort();//å†’æ³¡æ’åºä¸€ä¸ªé€šé“ç”µæ„Ÿçš„å€¼//
  130   1         average_value();//æ’åºå®Œçš„æ•°ç»„å»æ‰æœ€å¤§æœ€å°å€¼æ±‚å¹³å‡å€¼
  131   1         normalization();//å½’ä¸€åŒ–
  132   1      }
  133          //======================================================================
  134          //å‡½æ•°åç§° : cal_poserror
  135          //åŠŸèƒ½æè¿° : å·®æ¯”å’Œè®¡ç®—è¯¯å·®
  136          //è¾“å…¥å‚æ•° : 
  137          //è¾“å‡ºå‚æ•° : 
  138          //è¿”å›å€¼   : NONE
  139          //å¤‡æ³¨     :  acrossæ¨ªç”µæ„Ÿ verticalç«–ç”µæ„Ÿ splayedå…«å­—å‹
  140          //        (/ å  å \)
  141          //======================================================================
  142          // void cal_poserror(float a_Ls,float a_La,float a_Lv,float a_Rs,float a_Ra,float a_Rv)
  143          // {
  144          //    float cha ,he;
  145          //    cha = my_sqrt()
  146          
  147          // }
  148          
  149          
  150          
  151          
  152          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       482     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       144          8
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        28     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
